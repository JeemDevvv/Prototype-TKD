<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Dashboard | ARISE</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css" integrity="sha512-2SwdPD6INVrV/lHTZbO2nodKhrnDdJK9/kg2XD1r9uGqPo1cUbujc+IYdlYdEErWNu69gVcYgdxlmVmzTWnetw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <link rel="stylesheet" href="../css/styles.css?v=2">
  <style>
    /* Force responsive layout for all screen sizes */
    * { box-sizing: border-box !important; }
    
    @media (max-width: 1200px) {
      .admin-shell { grid-template-columns: 1fr !important; }
      /* Keep sidebar available for off-canvas behavior; do not hide it */
      .admin-main { width: 100vw !important; max-width: 100vw !important; padding: 0.5rem !important; margin: 0 !important; }
      .kpi-grid { grid-template-columns: repeat(2, 1fr) !important; width: 100% !important; }
      .dash-grid { grid-template-columns: 1fr !important; width: 100% !important; }
    }
    
    @media (max-width: 900px) {
      .admin-main { width: 100vw !important; max-width: 100vw !important; padding: 0.3rem !important; }
      .kpi-grid { grid-template-columns: 1fr !important; width: 100% !important; }
      .kpi-card, .dash-card { width: 100% !important; max-width: 100% !important; }
      .section { width: 100% !important; max-width: 100% !important; }
    }
    
    @media (max-width: 600px) {
      .admin-main { padding: 0.2rem !important; }
      .dash-header { flex-direction: column !important; align-items: stretch !important; }
      .dash-actions { width: 100% !important; }
    }
  </style>
</head>
<body class="admin-dashboard">
  <!-- Navbar -->
  <header class="pta-navbar">
    <div class="pta-navbar-content">
      <div class="pta-navbar-left">
        <button class="pta-navbar-toggle" id="ptaNavbarToggle" aria-label="Toggle navigation">
          <i class="fas fa-bars"></i>
        </button>
      </div>
      <div class="pta-navbar-center">
        <img src="../public/arise.png" alt="PTA Logo" class="pta-logo">
      </div>
      <div class="pta-navbar-right" id="ptaNavMenu">
        <div class="pta-navbar-buttons">
          <a href="#" class="btn btn-nav js-open-stats"><i class="fas fa-chart-bar"></i> Check Stats</a>
          <button id="logoutBtn" class="btn btn-logout"><i class="fas fa-sign-out-alt"></i> Logout</button>
        </div>
      </div>
    </div>
  </header>

    <main class="admin-shell">
      <aside class="admin-sidebar">
        <div class="admin-brand">
          <img src="../public/arise.png" alt="ARISE" class="sidebar-logo-small">
          <span id="adminRoleText">ARISE Admin</span>
        </div>
        <nav class="admin-nav">
          <button class="nav-link active" data-section="home"><i class="fas fa-home"></i> Home</button>
          <button class="nav-link" data-section="players"><i class="fas fa-users"></i> Players</button>
          <button class="nav-link" data-section="accounts"><i class="fas fa-user-cog"></i> Accounts</button>
          <button class="nav-link" data-section="settings"><i class="fas fa-cog"></i> Settings</button>
        </nav>
        <div class="admin-sidebar-divider"></div>
        <div class="admin-sidebar-actions">
          <button id="themeToggle" class="btn sidebar-action"><i class="fas fa-moon"></i> Toggle Theme</button>
        </div>
      </aside>

    <section class="admin-main">
      <header class="dash-header">
        <div class="dash-title">
          <h2 id="sectionTitle">Home</h2>
        </div>
        <h1>hotdog</h1>
        <p id="userGreeting" class="dash-greeting" style="display: none;">Hello, <span id="userName">Loading...</span>!</p>
        <div class="dash-actions" id="sectionActions">
          <button id="addPlayerBtn" class="btn btn-primary" style="display:none">Add Player</button>
        <button id="exportExcelBtn" class="btn" style="display:none">
          <i class="fas fa-file-excel"></i> Export Excel
        </button>
        <button id="importExcelBtn" class="btn" style="display:none">
          <i class="fas fa-file-import"></i> Import Excel
        </button>
        </div>
      </header>

      <section id="sec-home" class="section">
        <div class="kpi-grid">
          <div class="kpi-card"><div class="kpi-label">Total Players</div><div class="kpi-value" id="kpiPlayers">0</div></div>
          <div class="kpi-card"><div class="kpi-label">Male</div><div class="kpi-value" id="kpiMale">0</div></div>
          <div class="kpi-card"><div class="kpi-label">Female</div><div class="kpi-value" id="kpiFemale">0</div></div>
          <div class="kpi-card"><div class="kpi-label">Upcoming Exams</div><div class="kpi-value" id="kpiExams">0</div></div>
        </div>
        <div class="dash-card" style="margin-top:1rem;">
          <div class="dash-sub" style="margin-bottom:0.5rem">Recent History</div>
          <div id="recentHistory" class="recent-history-container">
            <div class="recent-history-loading">Loading recent activities...</div>
          </div>
        </div>
      </section>

      <section id="sec-players" class="section">
        <div class="dash-grid">
          <div class="dash-card">
            <div class="player-table-header">
              <div class="dash-search" id="playersSearchWrap" style="display:none">
                <input id="playerSearch" type="text" placeholder="Search players..." aria-label="Search players">
              </div>
            </div>
            <div class="player-table-section">
              <table id="playerTable" class="dash-table">
                <thead>
                  <tr>
                    <th>NCC Ref</th>
                    <th>Name</th>
                    <th>Gender</th>
                    <th>Belt</th>
                    <th>Birthdate</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
            </div>
          </div>
          <div id="playerDetails" class="dash-card details-card">
            <div class="details-head">
              <img id="detailPhoto" src="" alt="Player Photo" class="details-photo">
              <div>
                <h3 id="detailName">Select a player</h3>
                <div class="kv"><span>NCC#</span><strong id="detailNcc">-</strong></div>
                <div class="kv"><span>Birthday</span><strong id="detailBirth">-</strong></div>
                <div class="kv"><span>Address</span><strong id="detailAddress">-</strong></div>
                <div class="kv"><span>Contact #</span><strong id="detailContact">-</strong></div>
                <div class="kv"><span>Belt Rank</span><strong id="detailBelt">-</strong></div>
                <div class="kv"><span>Last Promotion Exam</span><strong id="detailLastExam">-</strong></div>
                <div class="kv"><span>Next Belt</span><strong id="detailNextBelt">-</strong></div>
              </div>
            </div>
            <div class="details-lists">
              <div class="list"><strong>Competitions</strong>
                <ul id="detailCompetitions"></ul>
              </div>
              <div class="list"><strong>Achievements</strong>
                <ul id="detailAchievements"></ul>
              </div>
            </div>
          </div>
        </div>
      </section>

      <section id="sec-accounts" class="section">
        <div class="accounts-container">
          <!-- Header -->
          <div class="accounts-header">
            <h2 class="accounts-title">Accounts Management</h2>
            <button id="addAccountBtn" class="btn btn-primary accounts-add-btn">
              <i class="fas fa-plus"></i>
              Add New Account
            </button>
          </div>

          <!-- Search and Filter -->
          <div class="accounts-filters">
            <div class="search-container">
              <input type="text" id="accountSearch" placeholder="Search accounts..." class="search-input">
              <i class="fas fa-search search-icon"></i>
            </div>
            <select id="roleFilter" class="filter-select">
              <option value="">All Roles</option>
              <option value="admin">Admin</option>
              <option value="coach">Coach</option>
              <option value="assistant">Assistant Coach</option>
            </select>
          </div>

          <!-- Accounts Table -->
          <div class="accounts-table-container">
            <table class="accounts-table" id="accountsTable">
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Username</th>
                  <th>Role</th>
                  <th>Email</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="accountsTableBody">
                <!-- Accounts will be populated here -->
              </tbody>
            </table>
          </div>
        </div>
      </section>

      <section id="sec-settings" class="section">
        <div class="dash-card">
          <div class="dash-sub">Settings</div>
          <p>General settings for your system. (Coming soon)</p>
        </div>
      </section>
    </section>
  </main>

    <!-- Add/Edit Player Modal (hidden by default) -->
    <div id="playerModal" class="modal hidden">
      <form id="playerForm">
        <input type="file" id="photoFile" name="photoFile" accept="image/*" placeholder="Attach Photo">
        <div style="margin:0.5rem 0 1rem 0; display:flex; align-items:center; gap:0.8rem;">
          <img id="photoPreview" alt="Preview" style="width:100px; height:100px; object-fit:cover; border-radius:0.6rem; background:#eee; display:none;" />
          <small id="photoHint" style="color:#666;">PNG/JPG up to 2MB</small>
        </div>
        <input type="text" name="name" placeholder="Name" required>
        <div style="position: relative; width: 100%;">
          <select name="gender" required style="width: 100%; padding: 0.75rem; padding-right: 2.5rem; border: 1px solid #ddd; border-radius: 0.375rem; font-size: 1rem; background-color: white; appearance: none; margin: 0;">
            <option value="">Gender</option>
            <option value="Male">Male</option>
            <option value="Female">Female</option>
          </select>
          <i class="fa-solid fa-caret-down" style="position: absolute; right: 0.75rem; top: 50%; transform: translateY(-50%); pointer-events: none; color: #666; font-size: 0.875rem;"></i>
        </div>
        <input type="date" name="birthdate" placeholder="Birthday">
        <input type="text" name="address" placeholder="Address">
        <input type="text" name="contactNumber" placeholder="Contact #">
        <input type="text" name="beltRank" placeholder="Belt Rank" required>
        <input type="date" name="lastPromotionExam" placeholder="Last Promotion Exam">
        <input type="text" name="competitions" placeholder="Competition na sinalihan (comma separated)">
        <input type="text" name="nextBelt" placeholder="Next belt to take at next promo">
        <textarea id="requiredForms" name="requiredForms" placeholder="Specific forms needed to perform at self-defense" rows="3" maxlength="280"></textarea>
        <div style="text-align:right; font-size:0.9rem; color:#666; margin-top:-0.4rem; margin-bottom:0.6rem;">
          <span id="formsCounter">0/280</span>
        </div>
        <input type="text" name="achievements" placeholder="Achievements (comma separated)">
        <input type="text" name="nccRef" placeholder="NCC # (if meron)">
        <button type="submit" class="btn">Save</button>
        <button type="button" id="closeModalBtn" class="btn btn-cancel">Cancel</button>
      </form>
    </div>
  </main>

  <script src="../js/main.js?v=2"></script>
  <link rel="icon" href="../public/logo.jpg">

  <script>
    // Allow overriding API base via localStorage for this page
    window.setApiBase = function(url){ try { localStorage.setItem('API_BASE', url); alert('API base set. Reload the page.'); } catch(e) { alert('Failed to set API base'); } };
    // Example usage in console: setApiBase('http://localhost:4000/api')
  </script>

  <!-- Reusable Check Stats Modal on Dashboard -->
  <div class="modal hidden" id="statsModal">
    <div class="check-stats-container" role="dialog" aria-modal="true" aria-labelledby="statsTitle">
      <button id="closeStatsModal" class="stats-close" aria-label="Close">
        <i class="fas fa-times"></i>
      </button>
      <div class="stats-header">
        <h2 id="statsTitle">Check My Stats</h2>
        <p class="stats-subtitle">Enter your NCC reference number to view your information.</p>
      </div>
      <form id="searchForm">
        <div class="input-group">
          <input type="text" name="nccRef" placeholder="Enter NCC Reference Number" required>
        </div>
        <button type="submit" class="btn">
          <i class="fas fa-search"></i>
          Search
        </button>
      </form>
      <div id="searchResult"></div>
    </div>
  </div>

  <!-- Add/Edit Account Modal -->
  <div id="accountModal" class="modal hidden">
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="modalTitle">Add New Account</h3>
        <button id="closeAccountModal" class="modal-close"><i class="fas fa-times"></i></button>
      </div>
      <form id="accountForm" data-mode="add">
        <input type="hidden" id="accountId" name="id">
        <div class="form-group">
          <label for="accountName">Full Name *</label>
          <input type="text" id="accountName" name="name" required>
        </div>
        <div class="form-group">
          <label for="accountUsername">Username *</label>
          <input type="text" id="accountUsername" name="username" required>
        </div>
        <div class="form-group">
          <label for="accountEmail">Email *</label>
          <input type="email" id="accountEmail" name="email" required>
        </div>
        <div class="form-group" id="passwordGroup">
          <label for="accountPassword">Password *</label>
          <input type="password" id="accountPassword" name="password">
        </div>
        <div class="form-group">
          <label for="accountRole">Role *</label>
          <select id="accountRole" name="role" required>
            <option value="">Select Role</option>
            <option value="admin">Admin</option>
            <option value="coach">Coach</option>
            <option value="assistant">Assistant Coach</option>
          </select>
        </div>
        <div class="modal-actions">
          <button type="button" id="cancelAccountBtn" class="btn btn-secondary">Cancel</button>
          <button type="submit" class="btn btn-primary">Save Account</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Custom Notification Container -->
  <div id="notificationContainer" class="notification-container">
    <div id="notification" class="notification hidden">
      <div class="notification-content">
        <div class="notification-title-container">
          <i class="fas fa-exclamation-triangle notification-icon"></i>
          <h3 class="notification-title">Access Denied</h3>
        </div>
        <p class="notification-message">Only administrators can access the Accounts section.</p>
      </div>
      <button id="notificationClose" class="notification-close">
        <i class="fas fa-times"></i>
      </button>
    </div>
  </div>
</body>
</html> 